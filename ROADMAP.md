# ROADMAP.md â€” Agar.io Clone

This file tracks the progress of each phase. Update the status of each phase as work progresses.

---

## Phases

### Phase 1 â€” Project Foundation & Game Canvas
**Status:** âœ… Complete (Opus Approved)

**Goal:** Working Next.js app with a Phaser canvas, local single-player gameplay, and food pellet eating.

**Scope:**
- T3 app scaffolded (no auth, no Prisma) âœ…
- Phaser.js installed âœ…
- SpacetimeDB JS SDK installed âœ…
- `.claude/settings.json` with Opus Stop hook âœ…
- SpacetimeDB Rust module scaffolded âœ…
- Lobby screen â€” player enters name and clicks Play
- Phaser game canvas fills the screen
- Player cell rendered, moves toward mouse cursor
- Large world (3000x3000) with grid background and boundary walls
- Viewport camera follows the player
- Food pellets spawned randomly (200+ pellets), client-side
- Player eats food on overlap and grows in radius

**Opus Audit:** âœ… Approved

---

### Phase 2 â€” SpacetimeDB Integration
**Status:** âœ… Complete (Opus Approved)

**Goal:** Move all game state to SpacetimeDB Maincloud and sync between clients in real-time.

**Scope:**

- SpacetimeDB Rust module tables: `Player`, `FoodPellet`, `GameConfig` âœ…
- Reducers: `spawn_player`, `update_position`, `eat_food`, `despawn_player` âœ…
- Client connects via SpacetimeDB JS SDK to Maincloud âœ…
- Player positions broadcast in real-time to all clients âœ…
- Food pellets managed server-side (respawn on eat) âœ…
- Player disconnection cleans up their cell âœ…
- Two browser tabs show each other's cells moving and eating food âœ…

**Opus Audit:** âœ… Approved

---

### Phase 3 â€” Core Game Mechanics
**Status:** âœ… Complete (Opus Approved)

**Goal:** Full Agar.io gameplay loop.

**Scope:**

- Player-eats-player logic (larger absorbs smaller on overlap) âœ…
- Mass/size decay over time âœ…
- Minimap showing all players âœ…
- Live leaderboard (top 5 by size) âœ…
- Eject mass mechanic (W key) âœ…
- Cell split mechanic (Space key) â€” merges back after delay âœ…
- Respawn flow after being eaten âœ…

**Post-Phase Bugfixes (Opus Approved):**

- Camera no longer jumps on first join (deferred `startFollow` until server confirms spawn) âœ…
- Ejected mass spawns at circle surface instead of center for large blobs âœ…
- Ejected mass animation replaced with Phaser tween to server position (eliminates snap-back and self-eat bugs) âœ…
- In-flight ejected mass immune to collision via `ejectedAnimating` guard âœ…

**Opus Audit:** âœ… Approved

---

### Phase 4 â€” Polish & Shareability
**Status:** âœ… Complete (Opus Approved)

**Goal:** Fun, shareable game playable by friends via a URL.

**Scope:**
- Player name displayed above cell (fixed font size, doesn't scale with cell) âœ…
- Player picks color in lobby (8-color palette); server assigns random if 0 passed âœ…
- Eating animation: scale pulse (1.18Ã—) on local cell when mass increases âœ…
- Death animation: 12-particle burst at death position before cell hides âœ…
- Grid background (classic Agar.io look) âœ… (was already done in Phase 1)
- Zoom scaling: camera smoothly zooms out as cell grows (sqrt formula, 0.3â€“1.0) âœ…
- Mobile touch support: movement via touch-pointer (already worked); on-screen Eject (W) and Split (Space) buttons added to HUD âœ…
- Deploy frontend to Vercel: NEXT_PUBLIC_SPACETIMEDB_URL env var wired up; documented in .env.example âœ…
- SpacetimeDB module confirmed live on Maincloud (published with color param) âœ…
- Shareable URL: game fully playable by opening the Vercel URL in any browser âœ…

**Opus Audit:** âœ… Approved

**Post-Phase Bugfixes (Opus Approved):**

- Split cell can now eat food pellets via `eat_food_cell` reducer (server checks PlayerCell position; mass credited to PlayerCell so it grows before merge) âœ…
- Split cell can now eat smaller players via `eat_player_cell` reducer (server checks PlayerCell position and mass; absorbs target into the split cell) âœ…
- HUD elements (minimap, leaderboard, buttons, overlay) no longer scale or shift position with camera zoom: a dedicated `uiCamera` (zoom=1, large scroll offset) renders all HUD objects while the main camera ignores them âœ…

---

## Status Legend

| Icon | Meaning |
|------|---------|
| ğŸ”² | Not Started |
| ğŸ”„ | In Progress |
| âœ… | Complete (Opus Approved) |
| âŒ | Blocked |
